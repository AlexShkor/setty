{"name":"Setty","body":"Overview\r\n---------------------\r\nSetty was designed to help manage project key/value settings. .NET config files differ for different deployment configurations. There should be a way to manage config files for different deployment configurations. Setty chose centralized approach by generating *.config files based on some template language. Currently there is support for razor and xslt transform engines. \r\n\r\nSetty with razor syntax require .net 4.0+. .net 2.0 version currently support only xslt transformation engine and has to be installed manually. See documentation below for details\r\n\r\nInstallation guide\r\n---------------------\r\nThe best way to getting started with Setty is download plugin for visual studio 2010. And install setty in one click.\r\nPlugin will configure everything for you.\r\n\r\n1. Open Visual Studio and navigate to Tools -> Extentions Manager. \r\n2. Search in Online Gallery for work 'Setty' and double click to install (reload Visual Studio after this). Or alternatively download extension [Setty VS 2010 addin](https://github.com/downloads/paralect/setty/Setty.VsAddin.vsix) \r\n![add vs extension](http://paralect.github.com/setty/images/add_vs_extention.png)\r\n3. Create new project (or open existing one), right click on it. In context menu navigate to Add -> Add Setty... \r\n![add vs extension](http://paralect.github.com/setty/images/images/add_setty.png)\r\n4. Plugin ask you where to create global settings folder. Usually this folder is on top of solution folder. \r\n![add vs extension](http://paralect.github.com/setty/images/browse_settings_folder.png)\r\n5. Congratulations! You are done. Now you can start use Setty.\r\n\r\nQuick start\r\n---------------------\r\nBy default setty use <a href=\"http://www.microsoft.com/web/category/razor\">Razor syntax</a> to transform setty config (Web.config.cshtml on above screen). \r\n  Settings Folder is a simple concept of hierarchical configuration system well understood by many ASP.NET developers. The more deeper your configuration file is located the more precedence your configuration file has comparing to outer configuration files. This is a simple way to overwrite outer configuration. Here is example from real world:\r\n\r\n![example](http://paralect.github.com/setty/images/settings_folder.png)\r\n\r\nTo try it out navigate to the settings folder which you've specified on 4th step. There you'll find App.config file. This file is a simple storage of key/value settings. Settings Folder has only one configuration file named App.config. Content of this file is a plain .NET appSettings section. \r\n\r\nOpen it and add new setting:\r\n``` xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<configuration>\r\n  <appSettings>\r\n  \t<add key=\"hello\" value=\"Hello World\"/>\r\n  </appSettings>\r\n</configuration>\r\n```\r\nAfter this open your setty config file (In my case it's Web.config.cshtml) and use setting as follow:\r\n``` xml\r\n<configuration>\r\n  <appSettings>\r\n    <add key=\"MyFirstSetting\" value=\"@Model[\"hello\"]\" />\r\n    ...\r\n```\r\nRebuild project and open Web.config file, there should be following result:\r\n``` xml\r\n<configuration>\r\n  <appSettings>\r\n    <add key=\"MyFirstSetting\" value=\"Hello World\" />\r\n    ...\r\n```\r\n\r\nReal world Setty config files\r\n---------------------\r\n\r\nBelow example show not only how to use Setty, but also flexibility that Setty provide by adding support\r\nof variables, conditions, whatever transformation language support.\r\n\r\nRazor transformation engine:\r\n\r\n``` xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n    <configuration>    \r\n\r\n      <appSettings>\r\n        <add key=\"Name\" value=\"@Model[\"Name\"]\" />\r\n        <add key=\"Email\" value=\"@Model[\"Email\"]\" />\r\n      </appSettings> \r\n\r\n      <system.web>\r\n        <sessionState mode=\"SQLServer\" sqlConnectionString=\"@Model[\"StateServer\"]\" />\r\n      </system.web> \r\n\r\n      <compilation debug=\"@Model[\"Debug\"]\" targetFramework=\"4.0\" /> \r\n\r\n      @if(Model[\"Email\"] == \"Compress\")\r\n       {\r\n        <httpCompression>\r\n          <scheme name=\"gzip\" dll=\"%Windir%\\system32\\inetsrv\\gzip.dll\" />\r\n          <dynamicTypes>\r\n            <add mimeType=\"text/*\" enabled=\"true\" />\r\n            ...\r\n          </dynamicTypes>\r\n        </httpCompression> \r\n       }     \r\n          ...\r\n\r\n    </configuration>\r\n\r\n      \r\n```\r\n\r\nXslt transformation engine:\r\n\r\n\r\n``` xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<xsl:stylesheet version=\"1.0\"\r\n                xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n                xmlns:c=\"http://core.com/config\"> \r\n\r\n  <xsl:template match=\"/\">\r\n    <configuration>    \r\n\r\n      <appSettings>\r\n        <add key=\"Name\" value=\"{c:Value('Name')}\" />\r\n        <add key=\"Email\" value=\"{c:Value('Email')}\" />\r\n      </appSettings> \r\n\r\n      <system.web>\r\n        <sessionState mode=\"SQLServer\" sqlConnectionString=\"{c:Value('StateServer')}\" />\r\n      </system.web> \r\n\r\n      <compilation debug=\"{c:Value('Debug')}\" targetFramework=\"4.0\" /> \r\n\r\n      <xsl:if test=\"c:Value('Compress') = 'true'\">\r\n\r\n        <httpCompression>\r\n          <scheme name=\"gzip\" dll=\"%Windir%\\system32\\inetsrv\\gzip.dll\" />\r\n          <dynamicTypes>\r\n            <add mimeType=\"text/*\" enabled=\"true\" />\r\n            ...\r\n          </dynamicTypes>\r\n        </httpCompression>\r\n\r\n      </xsl:if> \r\n\r\n      ...\r\n\r\n    </configuration>\r\n\r\n  </xsl:template> \r\n\r\n</xsl:stylesheet>\r\n\r\n```\r\n\r\n.setty file\r\n---------------------\r\nSetty use .setty file to locate settings folder for the current environment.\r\n\r\n1.Usually you will need only one .setty for the all solution projects.\r\n \r\n Without any special arguments setty.exe will start search for .setty file at the current directory (where *.config.cshtml located). If .setty will not find it will look into the parent folder, therefore if you want to have one .setty for the all projects and you have project structure like below, you can just put .setty under source folder and it will be used to transform all solution configs:\r\n\r\n``` text \r\nD:\\\\MyProject\\\r\n     settings\r\n      App.config\r\n         Stage\r\n             App.config\r\n         Production\r\n             App.config\r\n\r\n     source                \r\n         Project1Folder\r\n             web.config.cshtml\r\n         Project2Folder\r\n             app.config.cshtml\r\n      .setty.config\r\n```\r\n\r\n 2.Separate .setty file for particular project\r\n\r\nTo use separate settings for particular project you can just put .setty near *.config.cshtml and it will be used to locate settings.\r\n\r\n 3.Content of the .setty file\r\n\r\nPath file can contains FULL or RELATIVE path to the settings folder.\r\nExamples of path file content(based on above project structure):\r\n\r\n  * `D:\\\\MyProject\\settings\\Stage` \r\n  * `../settings` (relative path should not starts from slash, because it will be treat as absolute path)\r\n\r\n\r\nSetty and version of control \r\n---------------------\r\n\r\nThe .setty file should not be under your source control system, because in most situations developers and different environments has different paths within .setty and you will continuously merge this file. \r\nSame apply for any .config file, because setty always regenerate it you need add it to ignore as well.\r\n\r\n\r\nHow to install the Setty project\r\n---------------------\r\n\r\nBefore run solution you have to install some tools. If you have some of them just skip step.\r\n\r\n\r\n1. Clone project from github\r\n\r\n `git clone git@github.com:paralect/setty.git`\r\n\r\n2. <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=17630\">Download</a> and install ILMerge. It used to merge some external libraries into single .exe file.\r\n\r\n3. <a href=\"https://github.com/downloads/loresoft/msbuildtasks/MSBuild.Community.Tasks.v1.4.0.42.msi\"> Download </a> and install MsBuild community tasks.\r\nAbove three steps should be enough to open and compile all solution projects except VS addin project.\r\n\r\n4. To open Setty.VsAddin project <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=21835\">download</a> and install visual studio sdk.\r\n<a href=\"http://visualstudiogallery.msdn.microsoft.com/e9f40a57-3c9a-4d61-b3ec-1640c59549b3/\">Donwload</a> and install VSPackage Builder plugin\r\n\r\n5. Restart Visual studio and open solution again. Congratulations! You are done!\r\n\r\n\r\nExtend Setty with you favorite transformation language\r\n---------------------\r\n\r\nFork setty project, install it first.\r\n\r\nTo add new transformation language into the project open Setty Project within Setty solution and implement ITransformer interface (put realization and all related files under Engines folder)\r\nThis interface has one method `void Transform(String inputFilePath, String outputFilePath, KeyValueConfigurationCollection settings)` \r\nTransformer accept path to the config file, transform it with key/value settings and save result to the output config file. \r\nAlso in interface you need to specify `ConfigExtention` for a new engine (for example: xslt, cshtml). Setty will automatically choose transformer by ConfigExtention\r\nOnce interface implemented add new engine config files names into `SettyConstants.SearchConfigsNames`. \r\n\r\nAll externals libs should be merged into the Setty.dll and Setty.exe files. To add them unload Setty project and modify following section at the bottom of .csproj file. After this do the same at Setty.Host project.\r\n\r\n``` xml\r\n<Target Name=\"AfterBuild\" Condition=\"$(Configuration) == 'Publish'\">\r\n    <ItemGroup>\r\n      <InputAssemblies Include=\"$(OutputPath)\\Setty.dll\" />\r\n      <InputAssemblies Include=\"$(OutputPath)\\Setty.Settings.dll\" />\r\n      <InputAssemblies Include=\"$(OutputPath)\\RazorEngine.dll\" />\r\n      <InputAssemblies Include=\"$(OutputPath)\\System.Web.Razor.dll\" />\r\n    </ItemGroup>\r\n    <Message Text=\"Merging assemblies...\" />\r\n    <MakeDir Directories=\"$(OutputPath)\\Published\" />\r\n    <ILMerge TargetPlatformVersion=\"v4\" InputAssemblies=\"@(InputAssemblies)\" OutputFile=\"$(OutputPath)\\Published\\Setty.dll\" DebugInfo=\"false\" />\r\n</Target>\r\n```\r\n\r\nConratulations! You are done. <a href=\"https://help.github.com/articles/using-pull-requests/\">Send pull request</a> to us and we will merge it in.\r\n\r\n\r\nSetty and nuget\r\n---------------------\r\n\r\nSome nugets automatically can modify your config file, but because of setty regenerate config files you can loose these changes on next build.\r\nSo developer should manually copy nuget config changes into setty config file. \r\n\r\nThis is not always bad, because some of the nugets can do crazy things with your config and add stuff that you don't like to see in config.\r\n\r\n\r\nManual Setty Installation (Based on xslt transformation engine)\r\n---------------------\r\n\r\nIn your existing project add corresponding configuration template file just near your normal configuration file (App.config or Web.config). Name this template by adding .xslt extension to the file (App.config.xslt or Web.config.xslt). Start with the following template:\r\n\r\n``` xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<xsl:stylesheet version=\"1.0\" exclude-result-prefixes=\"c\" \r\n                xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n                xmlns:c=\"http://setty.org/config\">\r\n\r\n  <xsl:template match=\"/\">\r\n      <!-- Place your configuration here -->\r\n  </xsl:template>\r\n\r\n</xsl:stylesheet>\r\n\r\n```\r\n\r\nNow just copy full content of App.config to this template. By doing this you will receive the same App.config file after transformation. Integration with build process (via MSBuild) If your project should produce configuration file - then add the following lines to the end of *.csproj file:\r\n\r\n``` xml\r\n<Target Name=\"Setty\" BeforeTargets=\"PreBuildEvent\">\r\n  <Exec Command=\"&quot;$(MSBuildProjectDirectory)\\..\\setty.exe&quot; /silent\" />\r\n</Target>\r\n\r\n```\r\n\r\nWith each build your configuration file will be produced by Setty.exe. \r\nYou should place Setty.exe file in the folder were your *.sln file exists (or choose any location you like and reflect this in MSBuild Exec task definition). You even can register Setty.exe in your PATH environment variable - but in this case your project will depend on system configuration.\r\n\r\nBTW: VS 2010 plugin do almost same steps.\r\n\r\n  ","tagline":"Setty component solves two common problems - management of key-value settings and management of .NET config files (App.config and Web.config)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}